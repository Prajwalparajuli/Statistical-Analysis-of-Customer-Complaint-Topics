## Statistical Analysis for Customer Complaints Topics
Businesses receive thousands of unstructured customer complaints every day. Analyzing these complaints can provide valuable insights into customer satisfaction and areas for improvement. In this analysis, we will explore the distribution of sample means using a Monte Carlo simulation approach. Our goal is to turn this raw text data into actionable insights by identifying which type of complaints leads to the most customer dissatisfaction.  

The primary objective of this analysis is to answer the following question:
Is there a statistically significant difference in the dispute rate between the complaint topics we discovered?

NLP topic modeling was done using LDA to identify 7 the most common topics in customer complaints. The topics identified were:
 - "Mortgage & Loan Servicing",        # Topic 0
 - "Debt Collection Calls",            # Topic 1
 - "Credit Report Issues",             # Topic 2
 - "Credit Card Rewards & Promotions", # Topic 3
 - "Liens & Disputed Re-insertions",   # Topic 4
 - "General Banking & Card Fees",      # Topic 5
 - "Legal Actions & Disputes"          # Topic 6

### Data
The pre-processed data derived from the initial NLP phase. The dataset contains 164,003 records, with each record including the original product category, the assigned dominant topic ID and label, and a binary indicator (disputed_binary) representing the customer's dispute status (1 for Yes, 0 for No).

```{r setup-and-load-data, message=FALSE, warning=FALSE}
library(tidyverse)
library(scales)

# Read the pre-processed csv data
labeled_complaints <- read_csv("statistical_analysis_data.csv")
head(labeled_complaints)
```

### Exploratory Data Analysis (EDA)
Before the hypothesis test, we need to see how the topics actually perform. We will group all 164,003 records by topic and calculate the percentage that were disputed for each topic. This gives us a ranked list and allows us to see which topics have the highest dispute rates and which have the lowest.

```{r topic-summary, message=FALSE, warning=FALSE}
# Grouping, summarizing, and ranking the topics by dispute rate
topic_summary <- labeled_complaints %>%
  group_by(topic_label) %>%
  summarize(
    Total_Complaints = n(),
    Disputes = sum(disputed_binary),
    .groups = 'drop') %>%
    mutate(Dispute_Rate = Disputes / Total_Complaints) %>%
    arrange(desc(Dispute_Rate))

# Display the summary table
print(topic_summary)
```
### Visualization of Dispute Rates

```{r visualize-dispute-rates, fig.width=10, fig.height=6}
ggplot(data = topic_summary, aes(x = Dispute_Rate, y = fct_reorder(topic_label, Dispute_Rate))) +
  geom_col(fill = "lightblue", width = 0.7) +
  geom_text(aes(label = paste0(round(Dispute_Rate * 100, 1), "%")), 
            hjust = -0.1, size = 3.5) +
  labs(
    title = "Consumer Dispute Rate by Complaint Topic",
    subtitle = "Analysis of 164,003 CFPB Complaint Narratives",
    x = "Dispute Rate (%)",
    y = "Complaint Topic"
  ) +
  scale_x_continuous(labels = scales::percent_format(accuracy = 1), 
                     expand = expansion(mult = c(0, 0.12))) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 14),
    axis.title = element_text(size = 14, face = "bold"),
    axis.text = element_text(size = 14, face = "bold")
  )
```

### Visualization of Raw Complaint Counts

```{r stacked-bar-chart, fig.width=10, fig.height=6}
# Create stacked data and keep n_complaints for ordering
stacked_data <- topic_summary %>% 
  mutate(n_non_disputes = Total_Complaints - Disputes) %>%
  select(topic_label, Total_Complaints, Disputes, n_non_disputes) %>%
  pivot_longer(cols = c(Disputes, n_non_disputes), 
               names_to = "Dispute_status", 
               values_to = "Count")
head(stacked_data)
# Plotting the stacked bar chart
ggplot(data = stacked_data, aes(x = Count, 
                              y = fct_reorder(topic_label, Total_Complaints), 
                              fill = Dispute_status)) +
    geom_bar(stat = "identity") +
    labs(
      title = "Consumer Disputes vs Non-Disputes by Complaint Topic",
      subtitle = "Analysis of 164,003 CFPB Complaint Narratives",
      x = "Number of Complaints",
      y = "Complaint Topic",
      fill = "Complaint Status"
    ) +
    scale_fill_manual(values = c("Disputes" = "#D55E00", "n_non_disputes" = "#009E73"),
                      labels = c("Disputed", "Not Disputed")) +
    theme_minimal() +
    theme(
      plot.title = element_text(size = 16, face = "bold"),
      plot.subtitle = element_text(size = 14),
      axis.title = element_text(size = 14, face = "bold"),
      axis.text = element_text(size = 14, face = "bold") 
    )
```


## Is there any statistically significant difference in the dispute rate among our 7 topics?

* **Null Hypothesis ($H_0$):** The proportion of disputes is the same for all 7 topics.
* **Alternative Hypothesis ($H_a$):** The proportion of disputes is not the same for at least on topic

```{r}
# Create a contingency table of topic labels and dispute status
contingency_table <- stacked_data %>%
  pivot_wider(names_from = Dispute_status, values_from = Count) %>%
  select(topic_label, Disputes, n_non_disputes)
print(contingency_table)

# Excluding the first column (topic labels) for the chi-squared test
observed_chi_squared <- chisq.test(contingency_table[, -1])
paste("Observed Chi-Squared Statistic:", observed_chi_squared$statistic)

# Create a null distrubution of Chi-Squared statistics via permutation
set.seed(123)  # For reproducibility
N <- 10000
chi_stat <- numeric(N)
for (i in 1:N) {
  shuffle <- sample(c(contingency_table$Disputes, contingency_table$n_non_disputes))

plot()

```


### Verify Test Assumptions
...

### Permutation Test for the Chi-Squared statistic
...



## What is the magnitude of the differnece in dispute rates between the topics with hightest and lowest dissatisfaction?

Based on the exploratory analysis, we have identified the topics with the highest and lowest dispute rates among those with substantial sample sizes. We will conduct our two-proportion z-test to compare the following two groups:

* **Group 1 (High Rate):** `Credit Report Issues`
* **Group 2 (Low Rate):** `General Banking & Card Fees`

Let $p_1$ be the true population proportion of disputes for `Credit Report Issues`, and $p_2$ be the true proportion for `General Banking & Card Fees`.

Our hypotheses are:

* **Null Hypothesis ($H_0$):** There is no difference in the true dispute rates between the two topics. ($H_0: p_1 - p_2 = 0$)
* **Alternative Hypothesis ($H_a$):** There is a non-zero difference in the true dispute rates. ($H_a: p_1 - p_2 \neq 0$)

We will test this at a significance level of $\alpha = 0.05$.

### Verifying Test Assumptions

Before proceeding with the two-proportion z-test, it is crucial to verify that our data meets the necessary assumptions.

While a t-test for a *mean* would require checking for normality (often using histograms or Q-Q plots, our test is for *proportions*. This test does not assume the underlying data is normal. Instead, it relies on the **Central Limit Theorem**, which applies if our sample sizes are sufficiently large.

The standard check for this is the **success-failure condition**: each group must contain at least 10 "successes" (disputes) and 10 "failures" (non-disputes).

We can confirm this using our `topic_summary` table for the two groups in our test:

1.  **`Credit Report Issues`:**
    * **Successes (Disputes):** 9,452
    * **Failures (Non-Disputes):** 29,846

2.  **`General Banking & Card Fees`:**
    * **Successes (Disputes):** 4,197
    * **Failures (Non-Disputes):** 20,656

Since all these values are in the thousands, they are substantially greater than the 10-count minimum. Our assumptions are confidently met, and we can proceed with the z-test.

### Two-Proportion Z-Test

```{r two-proportion-z-test, message=FALSE, warning=FALSE}

# Isolating the data for the two topics 
topic_high <- topic_summary %>% filter(topic_label == "Credit Report Issues")
topic_low <- topic_summary %>% filter(topic_label == "General Banking & Card Fees")

# Creating a vector of the number of successes (disputes) for each group
successes <- c(topic_high$n_disputes, topic_low$n_disputes)

# Creating a vector of the number of trials (total complaints) for each group
trials <- c(topic_high$n_complaints, topic_low$n_complaints)

observed_proportion_diff <- (topic_high$n_disputes / topic_high$n_complaints) - 
  (topic_low$n_disputes / topic_low$n_complaints)
paste("Observed difference in proportions:", observed_proportion_diff)

# Performing the two-proportion z-test
z_test_result <- prop.test(x= successes, n = trials ,correct = FALSE)

# Displaying the results
print(z_test_result)
```

## Interpretation of Statistical Test

The `prop.test()` function returned a **`p-value < 2.2e-16`**. This value is astronomically small, falling far below our pre-defined significance level of $\alpha = 0.05$. This indicates that the probability of observing such a large difference in dispute rates (or larger) purely by random chance is virtually zero.

Based on this overwhelming evidence, we **overwhelmingly reject the null hypothesis ($H_0$)**.

Furthermore, the **95% confidence interval** for the true difference in proportions is `[0.065, 0.078]`. This interval provides two key insights:
1.  It does **not** contain 0, reinforcing our rejection of the null hypothesis.
2.  It quantifies the magnitude of the difference. We are 95% confident that the true dispute rate for "Credit Report Issues" is between **6.5% and 7.8%** higher than for "General Banking & Card Fees."

The test confirms that the 7.2% difference we observed in our sample (24.1% vs 16.9%) is a genuine and statistically significant finding.

## Is there a statistically significant association between a complaint's topics and its product line?
....
* **Null Hypothesis ($H_0$):** The topic label and the product are independent (no association)
* **Alternative Hypothesis ($H_a$):** The topic label and the product are dependent (an assosiation exists)
...

### Verify Test Assumptions
...

### Chi-Squared ($X^2$) Test of Independence
...




## Final Conclusion & Recommendation

Our analysis successfully transformed over 160,000 unstructured customer complaints into a clear, data-driven insight. By combining NLP topic modeling with statistical inference, we have a definitive answer to our research question.

We conclude that there is a **highly statistically significant difference** in customer dissatisfaction between complaint topics.

**Recommendation:** The company should **prioritize a root-cause analysis** of its processes related to **"Credit Report Issues."** This topic is not just anecdotally problematic; it is a statistically proven, high-impact driver of customer disputes. We are 95% confident the dispute rate for this area is at least 6.5 percentage points higher than for general banking issues, representing the most critical area for improvement identified in this analysis.